<!DOCTYPE html>
<html>
    <head>
{{> @head.mst }}

    </head>

    <body>
        <div class="container">

		{{> @navbar.mst }}
		
		<h1>Menus</h1>
		
		<div id="menu-list-view">
		</div>

 		<button type="button" class="btn btn-default" id="new-menu-button">New</button>
		
		</div>
		   		

        <script src="js/jquery-3.1.1.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/login.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.34.7/css/bootstrap-dialog.min.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.34.7/js/bootstrap-dialog.min.js"></script>

		
        <script type="text/javascript">
  			$(document).ready(function() {
  		
				$('#menu-list-view').load("/menu/list/") ;
					
  				$('#new-menu-button').click(function() {
					var msg = $('<div></div>').load("/menu/create/", 
						function(response, status, xhr) {
							var dialog = new BootstrapDialog({ 
								title: 'New Menu',
								message: msg
							});
							
							dialog.realize() ;
							dialog.open() ;
        
							var form = msg.find('#menu-edit-dlg') ;
							form.submit(function(e) {

								$.ajax({
									type: "POST",
									dataType: "json",
									url: form.attr('action'),
									data: form.serialize(), // serializes the form's elements.
									success: function(data)
									{
										if ( data.success ) 
											dialog.close() ;
										else {
											form.html(data.content) ;
										}
									} 
								});
								
								e.preventDefault() ;
							}) ;
						}) ;
					}) ;
         			
        		
  			
    			$('.delete-menu-button').click( function() {
					var id = $(this).closest('tr').attr('id').substring(5) ;
					 $.ajax({
	        			url: '/menu/delete/',
			    	    type: 'POST',
	        			data: { 'id': id },
	        			cache: false,
	        			success: function(data, textStatus, jqXHR)
	        			{
	        				$('#menu-'+ id).remove() ;
			    	    },
	        			error: function(jqXHR, textStatus, errorThrown)
	        			{
	        			    // Handle errors here
	        			    console.log('ERRORS: ' + textStatus);
	        			    // STOP LOADING SPINNER
	        			}
			    	}) ;
				
				});
			});
		
		</script>
    </body>
</html>
